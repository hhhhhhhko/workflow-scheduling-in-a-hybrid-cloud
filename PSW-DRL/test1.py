import networkx
import matplotlib.pyplot as plt
from preprocess.XMLProcess import XMLtoDAG
from Q_learning_model import Q_learning
from preprocess.Workflow import Scientific_Workflow
from DQN_model import DQN
from Environment import Env
from Parameter import get_args
import random
import numpy as np
from Comparison_Algorithms.HEFT import HEFT
from Comparison_Algorithms.QLHEFT import QLHEFT
from Comparison_Algorithms.TSS import TSS
from Comparison_Algorithms.PSSA import PSSA
from Comparison_Algorithms.Baselines import Baselines
import heapq



scientific_workflow = Scientific_Workflow('CyberShake', 30)
dag = scientific_workflow.get_workflow()
dag.ranku = dag.get_ranku()
a = dag.ranku
print(a)

'''
ranku = []
for i in range(dag.n_job):
    a = dag.ranku_calc(i)
    ranku.append(a)
print(ranku)
'''
'''
wait_v = [4,7,3,9]
q_table = [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 49.50221833333334, 0, 49.88221833333334, 0, 49.52221833333334, 0, 49.552218333333336, 0, 49.96221833333334, 0, 0, 30.92175166666667, 0, 30.28175166666667, 0, 30.561751666666666, 0, 30.26175166666667, 0, 31.131751666666666, 0, 30.94175166666667, 0, 30.90175166666667, 0, 49.302218333333336], [0, 0, 0, 71.78375833333334, 0, 91.95915833333333, 0, 80.72322833333334, 0, 98.77478833333333, 0, 87.07262833333334, 0, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 0, 0, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 0, 0, 0, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 0, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 0, 0, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 0, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 0, 0, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 0, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 0, 0, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 0, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 0, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 0, 0, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 0, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 0, 74.83702166666667, 0, 92.33258166666667, 0, 59.66934166666667, 0, 68.48774166666666, 0, 81.05147166666667, 0, 70.95727166666667, 0, 69.74372166666666, 0], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 0, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 0, 0, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 0, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 0, 0, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 0, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 0, 0, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 0, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 0, 0, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 0, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 0, 0, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 0, 30.94175166666667, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 0, 0, 70.95727166666667, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 0, 30.90175166666667, 69.74372166666666, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 0, 0, 69.74372166666666, 49.302218333333336], [0, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 0, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 0, 49.302218333333336], [0.06, 10.072443666666668, 147.64665833333333, 71.78375833333334, 49.50221833333334, 91.95915833333333, 49.88221833333334, 80.72322833333334, 49.52221833333334, 98.77478833333333, 49.552218333333336, 87.07262833333334, 49.96221833333334, 242.6489916666667, 86.29963166666667, 30.92175166666667, 74.83702166666667, 30.28175166666667, 92.33258166666667, 30.561751666666666, 59.66934166666667, 30.26175166666667, 68.48774166666666, 31.131751666666666, 81.05147166666667, 30.94175166666667, 70.95727166666667, 30.90175166666667, 0, 0]]
state_actions = q_table[2]
print(state_actions)
legal_v = [state_actions[i] for i in wait_v]
print(legal_v)
max_value_action = np.argmax(legal_v)  # 返回可取合法索引对应值的最大索引号
print(max_value_action)
selected_vertex = np.where(legal_v == max_value_action)[0]
print(selected_vertex)
'''